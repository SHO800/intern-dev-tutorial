# JavaScriptを始めよう

> 想定時間: 90分
> 動作環境: Google Chrome

<details>
  <summary>TOC</summary>

  1. JavaScript に触れてみよう
     1. ブラウザの開発者ツールを見よう
     2. Hello, World! しよう
     3. 読みやすいコードを書くために
        1. 厳格モード
        2. コメント
        3. 命名
        4. インデント
  2. JavaScript で処理させよう
     1. 四則演算
     2. その他の算術演算
     3. 文字列の処理
     4. 論理演算
  3. 条件によって処理を変えよう
     1. 比較演算子
     2. if文
     3. 三項演算子
  4. 繰り返し処理をさせよう
     1. for文
     2. `Array.prototype.forEach()`
  5. 非同期処理を使おう
     1. `Promise`/`then()`
     2. `async`/`await`
  6. ブラウザの標準APIを使ってみよう
     1. ファイルAPI
     2. 位置情報API
  7. コードをまとめてわかりやすくしよう
     1. 関数
     2. オブジェクト
     3. クラス

</details>

## 1. JavaScript に触れてみよう

JavaScript(以下JS)とは一般にWeb開発やシステム開発に用いられるプログラミング言語の一つです。
今回はインターンでのチーム開発にあたって基礎的なJSについて説明します。
> **※注意** 本記事には一部説明の簡単のために厳密には正しくない表現・説明があります。なるべく正確な記述を行いますが、気になる箇所は参考文献にある記事などから調べて貰えればと思います。

### 1-1. ブラウザの開発者ツールを見よう

Chromeではウィンドウ右上のケバブボタンから開いたメニューの「その他のツール」から「デベロッパーツール」を開けます。
![開発者ツールをひらく](imgs/open-devtool-from-kebab.png)
ショートカットキーが設定されているため、WindowsやChromeOSでは `Ctrl`+`Shift`+`I` で、macOSでは `Cmd`+`Option`+`I` でも開くことができます。また、ページの適当な部分で右クリックして「検証」を押すことでも開発者ツールが開けます。
無事にツールが開けていれば以下のような表示になるはずです。
![開発者ツール開いた見た目](imgs/devtool-opened-element.png)
開いているタブが要素タブ(Elementタブ)ではなかったり日本語化されてなかったり日本語化案内が出るかもしれませんが、ひとまずコンソールタブ(Consoleタブ)を開いてください。これで準備完了です。
![コンソールタブ](imgs/devtool-opened-console.png)

### 1-2. Hello, World! しよう

「新たにプログラミング言語の学習を始めるとき、まず`Hello, World!`から始める教」に入信しているため、まずは標準的な出力方法で「Hello, World!」を表示させることにします。
先程開いたコンソールタブに以下のコードを入力してみてください。

```JavaScript
console.log('Hello, World!');
```

実行すると以下の画像のように表示されるはずです。
![Hello, World!](imgs/hello-world.png)
このように、JSでは `Console.log(<任意の文字列>);` とすることでコンソールタブに出力を出すことができます。

### 1-3. 読みやすいコードを書くために

これから始まるインターンやその他でも「チーム開発」をしなければならないタイミングがあると思います。
そんなとき最も大事なことの一つが「**コードを読んだ人間に処理の意味・意図が伝わること**」です。
自分以外の人が見ても読みやすいコードを書くために、JSの機能やプログラムを書く上で気をつける点を説明します。

#### 1-3-1. 厳格モード

厳格モード (strictモード) とは、そうでない状態ではエラーにはならない微妙な実装をエラー扱いとするモードです。これによって、暗黙的に失敗していた処理をエラーとして検知できるようになったり、JSのエンジンが最適化しづらい手順を修正できるようになったりといったメリットがあります。しかし、利用したい構文がstrictモードに非対応である場合には注意が必要です。

厳格モードはJSのコード内に`"use strict";`と記述することで有効化できます。
試しに以下のコードを実行してみてください。

```JavaScript
"use strict";
a = 1;
```

![未宣言の変数に値を代入しようとしたエラー](imgs/strict-error-undefined-variable.png)
↑の画像のようにエラーが出れば問題なく厳格モードが有効になっています。この場合は未宣言の変数を操作しようとしたことでエラーが発生しています。
これは意図せずグローバル変数を宣言してしまうことを防いでくれます。

このように便利な厳格モードですが、スクリプト全体で有効にしてしまうと他のライブラリやファイルが厳格モードに対応しない記述で書かれていたときに動作しなくなってしまうことには注意が必要です。
使用方法のおすすめとしては関数の冒頭部で有効化するものです。そうすることで厳格モードは関数内でのみ有効になります。

#### 1-3-2. コメント

コメントは他のほぼすべてのプログラミング言語にもある「コード中に記述されているが処理に影響がない文」のことで、JSでは以下の二通りで記述できます。

```javascript
console.log('コメントの説明');
// console.log('これは一行だけをコメントにするやつ');
console.log('//が書いてある行にしか影響しない');

/**
 * console.log('これは複数行をコメントにするやつ');
 * console.log('/* から * /までの間が実行されない');
 */
```

コメントを適切に書くことでコードの意図や内容を他の開発者にわかりやすく伝えることができます。
また、実行したくないコードをコメントにすることで開発中のデバッグをやりやすくする使い方もあります。

#### 1-3-3. 命名

命名はプログラムを書く上で逃れられず、かつ難しい要素の一つです。
「名は体を表す」ということわざがありますが、意識するべきはまさにこれです。
コードを読む上でわざわざ他人の書いたコードをすべて読んで意味を理解してから使うことはあまりにも面倒です。そのため、完結で処理の内容や意味、効果がわかりやすい命名を変数・関数にするべきだとされています。

| 良い例 | 悪い例 |
| ---- | ---- |
| `let count = 0;` | `let a = 0;` |
| `function solveQuadraticEquation () {...}` | `function solve() {...}` |

1つ目の例はあまりにも極端ですが、`count`という名前で宣言されている方が変数の利用目的が明確です。
2つ目の例は場合によってどちらがいいかの判断が変わる場合があります。特にクラスのメンバとしてある式を解くような関数の場合では悪い例は悪いとは言い切れません。また、エディタの補完機能がない場合には冗長な命名の関数は嫌われるため良い例が必ずしも良いわけではありません。

時と場合に合わせて命名とコメントを組み合わせて誰が読んでもわかりやすいコードになるよう心がけましょう。

#### 1-3-4. インデント

インデントとは、行頭の字下げのことを指します。
主にコード中のブロックをわかりやすくするために利用されます。Pythonのようなインデントベースの言語ではブロックそのものを表すために使われますが、JSではコードのブロックは`{}`で表現されるため、インデントがなくてもエラーになったりはしません。
基本的にインデントをつけたほうが処理の塊がわかりやすくなるので、なるべくつけるようにしましょう。なお、`{}`で囲まれた文をそれまでの字下げよりもう1段階深くインデントするのが一般的です。

インデントなし

```javascript
function myFunc () {
let i = 0;
for (i = 0; i < 10; i++) {
console.log(i);
}
}
```

インデントあり

```javascript
function myFunc () {
  let i = 0;
  for (i = 0; i < 10; i++) {
    console.log(i);
  }
}
```

## 2. JavaScript で処理させよう

ここでは様々な計算や処理をJSにやってもらう方法を説明します。

### 2-1. 四則演算

計算といえばな四則演算からです。それぞれ以下のようにして記述することができます。

| 演算 | 記述 | 実行結果 |
| ---- | ---- | ---- |
| 加法 | `1 + 1` | ![加法演算](imgs/calc-plus.png) |
| 減法 | `1 - 1` | ![減法演算](imgs/calc-minus.png) |
| 乗法 | `2 * 2` | ![乗法演算](imgs/calc-multi.png) |
| 除法 | `2 / 2` | ![除法演算](imgs/calc-divide.png) |
| 剰余 | `3 % 2` | ![剰余演算](imgs/calc-remainder.png) |

この他に`+=`、`-=`のように二項演算子の後ろに`=`をつけることで左オペランドと右オペランドの計算結果を左オペランドに代入する加算代入演算子や減算代入演算子などもあります。

### 2-2. その他の算術演算

四則演算以外でも頻繁につかう演算がありますよね？
プログラム中で特に利用するインクリメントやデクリメントなどは演算子が用意されています。
また、三角関数のような高度な演算はJSでは `Math` という名前の組み込みオブジェクトから呼び出せます。

以下にいくつか例を示します。

| 演算 | 記述 | 実行結果 | 補足 |
| ---- | ---- | ---- | ---- | 
| インクリメント | 後置インクリメント:`x++`<br>前置インクリメント:`++x` | ![後置インクリメント処理](imgs/calc-after-increment.png)<br>![前置インクリメント処理](imgs/calc-before-increment.png) | 後置:先に評価結果を返して加算を行う<br>前置:先に加算を行って評価結果を返す |
| デクリメント | 後置デクリメント:`x--`<br>前置デクリメント:`--x` | ![後置デクリメント処理](imgs/calc-after-decrement.png)<br>![前置デクリメント処理](imgs/calc-before-decrement.png) | 後置:先に評価結果を返して減算を行う<br>前置:先に減算を行って評価結果を返す |
| べき乗 | `2 ** 2`<br>`Math.pow(2,2)` | ![べき乗演算子](imgs/calc-power-operator.png)<br>![Mathオブジェクトを利用](imgs/calc-power-mathobj.png) | べき乗演算子`**`が後に実装された |
| 円周率 | `Math.PI` | ![円周率](imgs/math-pi.png) |  |
| 正弦 | `Math.sin(θ)` | ![正弦](imgs/math-sin.png) |  |
| 余弦 | `Math.cos(θ)` | ![余弦](imgs/math-cos.png) |  |

その他のMathオブジェクトのプロパティやメソッドは[こちら](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Math)から確認できます。

### 2-3. 文字列の処理

文字列はJSではStringオブジェクトとして扱われ、様々な操作を行うことができます。連結、分割、置き換えなどの一部操作の方法を以下に示します。

| 操作 | 記述 | 実行結果 |
| ---- | ---- | ---- |
| 結合 | `'jig' + '.' + 'jp'` | ![結合](imgs/str-binding.png) |
| 結合 | `str += otherStr` | ![結合](imgs/str-bind-assign.png)
| 文字の取り出し | `'jig.jp'.charAt(1)` | ![文字取り出し](imgs/str-charat.png) |
| 分割 | `'jig.jp'.split('.')` | ![分割](imgs/str-split.png) |
| 文字列の切り出し | `'jig.jp'.slice(1, 4)` | ![文字列の切り出し](imgs/str-slice.png) |
| 文字列の置き換え | `'jig.jp'.replace('ji', 'じぇいあい')` | ![文字列の置き換え](imgs/str-replace.png) |
| 文字列の長さ | `'jig.jp'.length` | ![文字列の長さ](imgs/str-length.png) |
| 文字列の位置 | `'jig.jp'.indexOf('jp')` | ![文字列の位置](imgs/str-indexof.png) |

その他のStringオブジェクトのプロパティやメソッドは[こちら](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/String)から確認できます。

### 2-4. 論理演算

論理演算はプログラムで頻出する演算の一つです。それぞれの演算は以下のように表せます。

| 演算 | 記述 | 実行結果 |
| ---- | ---- | ---- |
| AND | `a && b` | ![and](imgs/calc-and.png) |
| OR | `a || b` | ![or](imgs/calc-or.png) |
| NOT | `!a` | ![not](imgs/calc-not.png) |

## 3. 条件によって処理を変えよう

数学の問題でも場合分けが発生するように、プログラムでも条件によって処理を変更したいことがあります。
ここではプログラムで条件分岐を記述する方法を説明します。

### 3-1. 比較演算子

場合分けが発生する簡単な例として、二次方程式の判別式Dがあります。判別式Dは以下の式で、次のような分岐がわかります。
判別式D: $D = b^2 - 4ac$
判別式Dの結果が

- 正の値 → 実数解
- 0 → 重解
- 負の値 → 虚数解

これはそれぞれ比較演算子を用いて以下のように表現できます。

- 正の値 → `value > 0`
- 0 → `value === 0`
- 負の値 → `value < 0`

JSではこのようにして値の大小や等価かどうかを比較できます。
以下に比較演算子の表を示します。

| 演算 | 記述 |
| ---- | ---- |
| `厳密等価` | `a === b` |
| `厳密不等価` | `a !== b` |
| `超過/より大きい` | `a > b` |
| `以上` | `a >= b` |
| `未満/より小さい` | `a < b` |
| `以下` | `a <= b` |

<details>
  <summary>厳密でない等価/不等価</summary>

  厳密等価/厳密不等価の演算が存在するということは、厳密**でない**等価・不等価の演算があると言うことです。
  これらは暗黙的な型変換を行うため一見して予想できない挙動をすることがあります。
  このため、通常は厳密等価演算子・厳密不等価演算子を使用することが推奨されます。

  | 演算 | 記述 |
  | ---- | ---- |
  | 等価 | `==` |
  | 不等価 | `!==` |
</details>

### 3-2. if文

3-1.でプログラムで条件を表現する方法を説明しました。この式を利用して先程の判別式Dの結果を評価し、実数解、重解、虚数解のどれになるかを出力するようなプログラムを作ることを考えてみましょう。
評価の結果によって処理を分岐させるためには `if`文 を使います。

```javascript
if (<条件1>) {
   条件1が真のときの処理
} else if(<条件2>) {
   条件2が真のときの処理
} else {
   条件1も条件2も偽のときの処理
}
```

if文は`()`内の評価結果が真のときに直後の`{}`で囲まれたブロック内の処理を行い、`()`内の評価結果が偽のときに直後の`else`句の処理を行います。このとき、`else`のあとに`if`でif文をつなげることで追加の条件分岐を追加できます。`else`のみのあとにある`{}`ブロック内の処理はそれより前にある`if`と`if else`のすべての条件を満たさなかったときに実行されます。
`if`~`else if`~`else`句は一連の処理の塊として捉えられます。この中で上から順に評価が行われるため、条件の強さには気をつける必要があります。

では判別式の結果から解がどうなるかを出力するプログラムを以下に書きます。

```javascript
let a, b, c;
a = <x2 の係数>;
b = <x の係数>;
c = <定数項>;

const d = b ** 2 - 4 * a * c;

if (d === 0) {
   console.log('重解');
} else if (d > 0) {
   console.log('実数解');
} else {
   console.log('虚数解');
}
```

実行結果は以下のようになります。

![重解](imgs/if-discriminant-1.png)![実数解](imgs/if-discriminant-2.png)

### 3-3. 三項演算子

三項演算子とは条件によって返す値を変えられる演算子です。
以下のような記法で利用できます。

```javascript
value = <条件> ? <条件が真のときの値> : <条件が偽のときの値>;
```

例えばある値の真偽によって値を返したいときに活用できます。↑の判別式の例を書き換えると以下のようになります。

```javascript
let a, b, c;
a = <x2 の係数>;
b = <x の係数>;
c = <定数項>;

const d = b ** 2 - 4 * a * c;

const res = d === 0
            ? '重解'
            : d > 0
              ? '実数解'
              : '虚数解';

console.log(res);
```

三項演算子はこのように三項演算子の下に三項演算子を書くことができます。
しかし、階層が深くなると複雑で読みづらくなるので注意が必要です。

![三項演算子](imgs/conditional-operator-1.png)![三項演算子](imgs/consitional-operator-2.png)

## 参考文献

- mdn web docs: <https://developer.mozilla.org/ja/docs/Web/JavaScript>
- JSPrimer: <https://jsprimer.net/>
- ECMAScript2020言語仕様　私的日本語訳: <https://xn--ecmascript2020-tt9vf572amitfjlc.com/>
